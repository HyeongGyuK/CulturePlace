<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{thymeleaf/layouts/cultureLayout}">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- 사용자 CSS 추가 -->
<th:block layout:fragment="css">
    <style>
        .fieldError {
            color: #bd2130;
        }
        .hcode{
            display: inherit;
            width : 200px;
        }
        #searchbox{
            display : inline;
        }
        #addressbox{
            display : inline;
        }


        #userjoinbox{
            width : 800px;
            margin : 0 auto;
            padding : 40px;
        }
    </style>
</th:block>

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">

    <script th:inline="javascript">
        $(document).ready(function(){
            var errorMessage = [[${errorMessage}]];
            if(errorMessage != null){
                alert(errorMessage);
            }
        });
    </script>
</th:block>

</head>
<div layout:fragment="content" id="userjoinbox">

    <form action="/users/new" role="form" method="post"  th:object="${memberFormDto}">
        <div class="form-group">
            <label th:for="MId">아이디</label>
            <input type="text" th:field="*{MId}" class="form-control col-11" placeholder="아이디 입력">
            <p th:if="${#fields.hasErrors('MId')}" th:errors="*{MId}" class="fieldError">Incorrect data</p>
        </div>

        <div class="form-group">
            <label th:for="password">비밀번호</label>
            <input type="password" th:field="*{password}" class="form-control col-11" placeholder="비밀번호 입력">
            <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="fieldError">Incorrect data</p>
        </div>
        <div class="form-group">
            <label th:for="name">이름</label>
            <input type="text" th:field="*{name}" class="form-control col-11" placeholder="이름을 입력해주세요">
            <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="fieldError">Incorrect data</p>
        </div>
        <div class="form-group">
            <label th:for="email">이메일주소</label>
            <input type="email" th:field="*{email}" class="form-control col-11" placeholder="이메일을 입력해주세요">
            <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="fieldError">Incorrect data</p>
        </div>

<!--  api test-->
        <div class="form-group">
            <label th:for="address" style="display:block">주소</label>

            <div id="searchbox">
            <input type="text" id="sample3_postcode"
                   th:field="*{address}" class="form-control col-7"
                   style="display:inherit" placeholder="우편번호"  size="10" readonly>

            <p th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="fieldError">Incorrect data</p>

            <input type="button" value="우편번호찾기"
                   onclick="sample3_execDaumPostcode()" class="form-control col-4 "
                   style="display:inline; margin-left:-6px; margin-bottom:3px;">
            </div>


            <input type="text" th:field="*{address}" id="sample3_address"
                   class="form-control col-11" placeholder="주소" readonly>
            <p th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="fieldError">Incorrect data</p>
            <div id="addressbox">
            <input  id="sample3_detailAddress"
                    type="text" class="form-control col-7" placeholder="상세주소를 입력해주세요"  style="display:inherit">

            <input type="text" id="sample3_extraAddress" class="form-control col-4" placeholder="세부주소"
                   style="display:inline; margin-left:-6px; margin-bottom:3px;" readonly>
            </div>
            <p th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="fieldError">Incorrect data</p>

        </div>
        <div id="wrap" style="display:none;border:1px solid;width:500px;height:300px;margin:5px 0;position:relative">
            <img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap"
                 style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
        </div>
        <div style="text-align: center">
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </form>
</div>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        var element_wrap = document.getElementById('wrap');

        function foldDaumPostcode() {
            element_wrap.style.display = 'none';
        }

        function sample3_execDaumPostcode() {
            var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
            new daum.Postcode({
                oncomplete: function(data) {

                    var addr = '';
                    var extraAddr = '';

                    if (data.userSelectedType === 'R') {
                        addr = data.roadAddress;
                    } else {
                        addr = data.jibunAddress;
                    }

                    if(data.userSelectedType === 'R'){
                        if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                            extraAddr += data.bname;
                        }
                        if(data.buildingName !== '' && data.apartment === 'Y'){
                            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                        }
                        if(extraAddr !== ''){
                            extraAddr = ' (' + extraAddr + ')';
                        }
                        document.getElementById("sample3_extraAddress").value = extraAddr;

                    } else {
                        document.getElementById("sample3_extraAddress").value = '';
                    }

                    document.getElementById('sample3_postcode').value = data.zonecode;
                    document.getElementById("sample3_address").value = addr;
                    document.getElementById("sample3_detailAddress").focus();

                    element_wrap.style.display = 'none';

                    document.body.scrollTop = currentScroll;
                },
                onresize : function(size) {
                    element_wrap.style.height = size.height+'px';
                },
                width : '100%',
                height : '100%'
            }).embed(element_wrap);
            element_wrap.style.display = 'block';
        }
    </script>
</th:block>

</html>

<!--  api test end-->
<!--주소 원본코드-->
<!--        <div class="form-group">-->
<!--            <label th:for="address"></label>-->
<!--            <input type="text" th:field="*{address}" class="form-control" placeholder="주소를 입력해주세요">-->
<!--            <p th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="fieldError">Incorrect data</p>-->
<!--        </div>-->
<!--        <div style="text-align: center">-->
<!--            <button type="submit" class="btn btn-primary">Submit</button>-->
<!--        </div>-->
<!--        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">-->
<!--    </form>-->
        <!--주소 원본코드-->

<!--    <table border="1">-->
<!--        <tr>-->
<!--            <td width="200">우편번호</td>-->
<!--            <td><input type="text" name="" id="" size="7"-->
<!--                       readonly>-->
<!--                <input type="button" value="우편번호찾기"-->
<!--                       onclick="kakaopost()"></td>-->
<!--        </tr>-->
<!--        <tr>-->
<!--            <td>주소</td>-->
<!--            <td><input type="text" name="address" id="address" size="70">-->
<!--            </td>-->
<!--        </tr>-->
<!--    </table>-->
